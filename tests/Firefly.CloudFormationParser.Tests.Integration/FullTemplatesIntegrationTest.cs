/*
** Generated by build/create-integration-tests.ps1
** Any direct changes to this file may be overwritten.
*/
namespace Firefly.CloudFormationParser.Tests.Integration
{
    using System;
    using System.IO;

    using Firefly.CloudFormationParser.Intrinsics.Functions;
    using Firefly.CloudFormationParser.Serialization.Settings;
    using Firefly.CloudFormationParser.TemplateObjects;
    using Firefly.CloudFormationParser.Tests.Common;

    using FluentAssertions;

    using Xunit;

    using YamlDotNet.Core;

    /// <summary>
    /// This test suite takes a bunch of templates from https://github.com/awslabs/aws-cloudformation-templates,
    /// deserializes them and records a DOT graph, re-serializes the output of the deserialization, then
    /// deserializes again and records another DOT graph.
    /// If the two DOT graphs are the same, then the deserialize-serialize process is deemed successful.
    /// </summary>
    /// <seealso cref="Firefly.EmbeddedResourceLoader.AutoResourceLoader" />
    public class FullTemplatesIntegrationTest : IClassFixture<FullTemplatesIntegrationTestFixture>
    {
        private readonly FullTemplatesIntegrationTestFixture fixture;

        public FullTemplatesIntegrationTest(FullTemplatesIntegrationTestFixture fixture)
        {
            this.fixture = fixture;
        }

        [SkippableTheory]
        [InlineData("1-initial-setup_template", "yaml", true)]
        [InlineData("1-initial-setup_template", "yaml", false)]
        [InlineData("2-managed-rules_template", "yaml", true)]
        [InlineData("2-managed-rules_template", "yaml", false)]
        [InlineData("3-custom-rules_template", "yaml", true)]
        [InlineData("3-custom-rules_template", "yaml", false)]
        [InlineData("4-reusable-setup_template", "yaml", true)]
        [InlineData("4-reusable-setup_template", "yaml", false)]
        [InlineData("5-reusable-setup-full_template", "yaml", true)]
        [InlineData("5-reusable-setup-full_template", "yaml", false)]
        [InlineData("ADCONNECTOR_cfn", "yaml", true)]
        [InlineData("ADCONNECTOR_cfn", "yaml", false)]
        [InlineData("admin", "yaml", true)]
        [InlineData("admin", "yaml", false)]
        [InlineData("api-enhanced-observability-variables_template", "yaml", true)]
        [InlineData("api-enhanced-observability-variables_template", "yaml", false)]
        [InlineData("app_template", "yaml", true)]
        [InlineData("app_template", "yaml", false)]
        [InlineData("AutoScalingMultiAZWithNotifications", "yaml", true)]
        [InlineData("AutoScalingMultiAZWithNotifications", "yaml", false)]
        [InlineData("both-declared_template", "yaml", true)]
        [InlineData("both-declared_template", "yaml", false)]
        [InlineData("both-implied_template", "yaml", true)]
        [InlineData("both-implied_template", "yaml", false)]
        [InlineData("C9", "yaml", true)]
        [InlineData("C9", "yaml", false)]
        [InlineData("cfn-endpoint-creationpolicy-no-igw", "yaml", true)]
        [InlineData("cfn-endpoint-creationpolicy-no-igw", "yaml", false)]
        [InlineData("cfn-endpoint-creationpolicy", "yaml", true)]
        [InlineData("cfn-endpoint-creationpolicy", "yaml", false)]
        [InlineData("cfn-endpoint-waitcondition-no-igw", "yaml", true)]
        [InlineData("cfn-endpoint-waitcondition-no-igw", "yaml", false)]
        [InlineData("cfn-endpoint-waitcondition", "yaml", true)]
        [InlineData("cfn-endpoint-waitcondition", "yaml", false)]
        [InlineData("cognito_template", "yaml", true)]
        [InlineData("cognito_template", "yaml", false)]
        [InlineData("Count_template", "yaml", true)]
        [InlineData("Count_template", "yaml", false)]
        [InlineData("Create-Macro", "yaml", true)]
        [InlineData("Create-Macro", "yaml", false)]
        [InlineData("create-secrets_template", "yaml", true)]
        [InlineData("create-secrets_template", "yaml", false)]
        [InlineData("Create-Stack", "yaml", true)]
        [InlineData("Create-Stack", "yaml", false)]
        [InlineData("dadjokes", "yaml", true)]
        [InlineData("dadjokes", "yaml", false)]
        [InlineData("demo-app_template", "yaml", true)]
        [InlineData("demo-app_template", "yaml", false)]
        [InlineData("DIRECTORY-AD-CLIENTS", "yaml", true)]
        [InlineData("DIRECTORY-AD-CLIENTS", "yaml", false)]
        [InlineData("DIRECTORY_SETTINGS_cfn", "yaml", true)]
        [InlineData("DIRECTORY_SETTINGS_cfn", "yaml", false)]
        [InlineData("dotnet-api_template", "yaml", true)]
        [InlineData("dotnet-api_template", "yaml", false)]
        [InlineData("DynamoDB_Secondary_Indexes", "yaml", true)]
        [InlineData("DynamoDB_Secondary_Indexes", "yaml", false)]
        [InlineData("DynamoDB_Table", "yaml", true)]
        [InlineData("DynamoDB_Table", "yaml", false)]
        [InlineData("EC2InstanceWithSecurityGroupSample", "yaml", true)]
        [InlineData("EC2InstanceWithSecurityGroupSample", "yaml", false)]
        [InlineData("EC2_Instance_With_Ephemeral_Drives", "yaml", true)]
        [InlineData("EC2_Instance_With_Ephemeral_Drives", "yaml", false)]
        [InlineData("EIP_With_Association", "yaml", true)]
        [InlineData("EIP_With_Association", "yaml", false)]
        [InlineData("ELBStickinessSample", "yaml", true)]
        [InlineData("ELBStickinessSample", "yaml", false)]
        [InlineData("eventbridge-dlq-retry_template", "yaml", true)]
        [InlineData("eventbridge-dlq-retry_template", "yaml", false)]
        [InlineData("eventbridge_template", "yaml", true)]
        [InlineData("eventbridge_template", "yaml", false)]
        [InlineData("events", "yaml", true)]
        [InlineData("events", "yaml", false)]
        [InlineData("example_usage_update_endpoint_policy", "yaml", true)]
        [InlineData("example_usage_update_endpoint_policy", "yaml", false)]
        [InlineData("example_usage_update_kms_policy", "yaml", true)]
        [InlineData("example_usage_update_kms_policy", "yaml", false)]
        [InlineData("FindInMapAZs", "yaml", true)]
        [InlineData("FindInMapAZs", "yaml", false)]
        [InlineData("FindInMap_Inside_Sub", "yaml", true)]
        [InlineData("FindInMap_Inside_Sub", "yaml", false)]
        [InlineData("function-template", "yaml", true)]
        [InlineData("function-template", "yaml", false)]
        [InlineData("go-al2_template", "yaml", true)]
        [InlineData("go-al2_template", "yaml", false)]
        [InlineData("http-api-direct-integration_template", "yaml", true)]
        [InlineData("http-api-direct-integration_template", "yaml", false)]
        [InlineData("http-api-integrations-blog-example_template", "yaml", true)]
        [InlineData("http-api-integrations-blog-example_template", "yaml", false)]
        [InlineData("http-api-logging_template", "yaml", true)]
        [InlineData("http-api-logging_template", "yaml", false)]
        [InlineData("http-api_template", "yaml", true)]
        [InlineData("http-api_template", "yaml", false)]
        [InlineData("http_template", "yaml", true)]
        [InlineData("http_template", "yaml", false)]
        [InlineData("IAM_Users_Groups_and_Policies", "yaml", true)]
        [InlineData("IAM_Users_Groups_and_Policies", "yaml", false)]
        [InlineData("kinesis-firehose_template", "yaml", true)]
        [InlineData("kinesis-firehose_template", "yaml", false)]
        [InlineData("lambda-static_cfn", "yaml", true)]
        [InlineData("lambda-static_cfn", "yaml", false)]
        [InlineData("layers-repo_template", "yaml", true)]
        [InlineData("layers-repo_template", "yaml", false)]
        [InlineData("MANAGEDAD_cfn", "yaml", true)]
        [InlineData("MANAGEDAD_cfn", "yaml", false)]
        [InlineData("multi-level-mapping_template", "yaml", true)]
        [InlineData("multi-level-mapping_template", "yaml", false)]
        [InlineData("Neptune", "yaml", true)]
        [InlineData("Neptune", "yaml", false)]
        [InlineData("node-webpack-custom-build_template", "yaml", true)]
        [InlineData("node-webpack-custom-build_template", "yaml", false)]
        [InlineData("Product", "yaml", true)]
        [InlineData("Product", "yaml", false)]
        [InlineData("python", "yaml", true)]
        [InlineData("python", "yaml", false)]
        [InlineData("RDS_PIOPS", "yaml", true)]
        [InlineData("RDS_PIOPS", "yaml", false)]
        [InlineData("RDS_Snapshot_On_Delete", "yaml", true)]
        [InlineData("RDS_Snapshot_On_Delete", "yaml", false)]
        [InlineData("RDS_with_DBParameterGroup", "yaml", true)]
        [InlineData("RDS_with_DBParameterGroup", "yaml", false)]
        [InlineData("reportingv1", "yaml", true)]
        [InlineData("reportingv1", "yaml", false)]
        [InlineData("reportingv2", "yaml", true)]
        [InlineData("reportingv2", "yaml", false)]
        [InlineData("rest_template", "yaml", true)]
        [InlineData("rest_template", "yaml", false)]
        [InlineData("RHEL7_cfn-hup_cfn", "yaml", true)]
        [InlineData("RHEL7_cfn-hup_cfn", "yaml", false)]
        [InlineData("RHEL8_cfn-hup_cfn", "yaml", true)]
        [InlineData("RHEL8_cfn-hup_cfn", "yaml", false)]
        [InlineData("s3-bucket-and-policy-for-caa-delete-retention-v1", "yaml", true)]
        [InlineData("s3-bucket-and-policy-for-caa-delete-retention-v1", "yaml", false)]
        [InlineData("s3-bucket-and-policy-for-caa-secure-transport-v1", "yaml", true)]
        [InlineData("s3-bucket-and-policy-for-caa-secure-transport-v1", "yaml", false)]
        [InlineData("s3-bucket-and-policy-for-caa-sse-v1", "yaml", true)]
        [InlineData("s3-bucket-and-policy-for-caa-sse-v1", "yaml", false)]
        [InlineData("s3-bucket-and-policy-for-caa-v1", "yaml", true)]
        [InlineData("s3-bucket-and-policy-for-caa-v1", "yaml", false)]
        [InlineData("s3-bucket-and-policy-for-caa-versioning-v1", "yaml", true)]
        [InlineData("s3-bucket-and-policy-for-caa-versioning-v1", "yaml", false)]
        [InlineData("s3-bucket-policy-for-caa-secure-transport-v1", "yaml", true)]
        [InlineData("s3-bucket-policy-for-caa-secure-transport-v1", "yaml", false)]
        [InlineData("s3-bucket-policy-for-caa-v1", "yaml", true)]
        [InlineData("s3-bucket-policy-for-caa-v1", "yaml", false)]
        [InlineData("S3AccessLogs_cfn", "yaml", true)]
        [InlineData("S3AccessLogs_cfn", "yaml", false)]
        [InlineData("S3_Website_Bucket_With_Retain_On_Delete", "yaml", true)]
        [InlineData("S3_Website_Bucket_With_Retain_On_Delete", "yaml", false)]
        [InlineData("S3_Website_With_CloudFront_Distribution", "yaml", true)]
        [InlineData("S3_Website_With_CloudFront_Distribution", "yaml", false)]
        [InlineData("safe-deploy_template", "yaml", true)]
        [InlineData("safe-deploy_template", "yaml", false)]
        [InlineData("sam_template", "yaml", true)]
        [InlineData("sam_template", "yaml", false)]
        [InlineData("server_template", "yaml", true)]
        [InlineData("server_template", "yaml", false)]
        [InlineData("SQS_template", "yaml", true)]
        [InlineData("SQS_template", "yaml", false)]
        [InlineData("stack-set-template", "yaml", true)]
        [InlineData("stack-set-template", "yaml", false)]
        [InlineData("stackset-function-template", "yaml", true)]
        [InlineData("stackset-function-template", "yaml", false)]
        [InlineData("step-functions_template", "yaml", true)]
        [InlineData("step-functions_template", "yaml", false)]
        [InlineData("string", "yaml", true)]
        [InlineData("string", "yaml", false)]
        [InlineData("string_example", "yaml", true)]
        [InlineData("string_example", "yaml", false)]
        [InlineData("swift-custom-runtime_template", "yaml", true)]
        [InlineData("swift-custom-runtime_template", "yaml", false)]
        [InlineData("Tagging_Root_volume", "yaml", true)]
        [InlineData("Tagging_Root_volume", "yaml", false)]
        [InlineData("ubuntu16_04LTS_cfn-hup_cfn", "yaml", true)]
        [InlineData("ubuntu16_04LTS_cfn-hup_cfn", "yaml", false)]
        [InlineData("ubuntu18_04LTS_cfn-hup_cfn", "yaml", true)]
        [InlineData("ubuntu18_04LTS_cfn-hup_cfn", "yaml", false)]
        [InlineData("ubuntu20_04LTS_cfn-hup_cfn", "yaml", true)]
        [InlineData("ubuntu20_04LTS_cfn-hup_cfn", "yaml", false)]
        [InlineData("VPCFlowLogs-main_cfn", "yaml", true)]
        [InlineData("VPCFlowLogs-main_cfn", "yaml", false)]
        [InlineData("VPCFlowLogsCloudWatch_cfn", "yaml", true)]
        [InlineData("VPCFlowLogsCloudWatch_cfn", "yaml", false)]
        [InlineData("VPCFlowLogsS3_cfn", "yaml", true)]
        [InlineData("VPCFlowLogsS3_cfn", "yaml", false)]
        [InlineData("VPCPeering-Accepter-Role_cfn", "yaml", true)]
        [InlineData("VPCPeering-Accepter-Role_cfn", "yaml", false)]
        [InlineData("VPCPeering-Accepter-Tag_cfn", "yaml", true)]
        [InlineData("VPCPeering-Accepter-Tag_cfn", "yaml", false)]
        [InlineData("VPCPeering-Accepter_main_cfn", "yaml", true)]
        [InlineData("VPCPeering-Accepter_main_cfn", "yaml", false)]
        [InlineData("VPCPeering-Requester-Setup_cfn", "yaml", true)]
        [InlineData("VPCPeering-Requester-Setup_cfn", "yaml", false)]
        [InlineData("VPCPeering-Requester_main_cfn", "yaml", true)]
        [InlineData("VPCPeering-Requester_main_cfn", "yaml", false)]
        [InlineData("VPCPeering-Updates_cfn", "yaml", true)]
        [InlineData("VPCPeering-Updates_cfn", "yaml", false)]
        [InlineData("VPC_EC2_Instance_With_Multiple_Static_IPAddresses", "yaml", true)]
        [InlineData("VPC_EC2_Instance_With_Multiple_Static_IPAddresses", "yaml", false)]
        [InlineData("VPC_With_Managed_NAT_And_Private_Subnet", "yaml", true)]
        [InlineData("VPC_With_Managed_NAT_And_Private_Subnet", "yaml", false)]
        [InlineData("web-app_template", "yaml", true)]
        [InlineData("web-app_template", "yaml", false)]
        [InlineData("WordPress_Single_Instance", "yaml", true)]
        [InlineData("WordPress_Single_Instance", "yaml", false)]
        [InlineData("1-initial-setup_template", "json", true)]
        [InlineData("1-initial-setup_template", "json", false)]
        [InlineData("2-managed-rules_template", "json", true)]
        [InlineData("2-managed-rules_template", "json", false)]
        [InlineData("3-custom-rules_template", "json", true)]
        [InlineData("3-custom-rules_template", "json", false)]
        [InlineData("4-reusable-setup_template", "json", true)]
        [InlineData("4-reusable-setup_template", "json", false)]
        [InlineData("5-reusable-setup-full_template", "json", true)]
        [InlineData("5-reusable-setup-full_template", "json", false)]
        [InlineData("ADCONNECTOR_cfn", "json", true)]
        [InlineData("ADCONNECTOR_cfn", "json", false)]
        [InlineData("admin", "json", true)]
        [InlineData("admin", "json", false)]
        [InlineData("api-enhanced-observability-variables_template", "json", true)]
        [InlineData("api-enhanced-observability-variables_template", "json", false)]
        [InlineData("app_template", "json", true)]
        [InlineData("app_template", "json", false)]
        [InlineData("AutoScalingMultiAZWithNotifications", "json", true)]
        [InlineData("AutoScalingMultiAZWithNotifications", "json", false)]
        [InlineData("both-declared_template", "json", true)]
        [InlineData("both-declared_template", "json", false)]
        [InlineData("both-implied_template", "json", true)]
        [InlineData("both-implied_template", "json", false)]
        [InlineData("C9", "json", true)]
        [InlineData("C9", "json", false)]
        [InlineData("cfn-endpoint-creationpolicy-no-igw", "json", true)]
        [InlineData("cfn-endpoint-creationpolicy-no-igw", "json", false)]
        [InlineData("cfn-endpoint-creationpolicy", "json", true)]
        [InlineData("cfn-endpoint-creationpolicy", "json", false)]
        [InlineData("cfn-endpoint-waitcondition-no-igw", "json", true)]
        [InlineData("cfn-endpoint-waitcondition-no-igw", "json", false)]
        [InlineData("cfn-endpoint-waitcondition", "json", true)]
        [InlineData("cfn-endpoint-waitcondition", "json", false)]
        [InlineData("cognito_template", "json", true)]
        [InlineData("cognito_template", "json", false)]
        [InlineData("Count_template", "json", true)]
        [InlineData("Count_template", "json", false)]
        [InlineData("Create-Macro", "json", true)]
        [InlineData("Create-Macro", "json", false)]
        [InlineData("create-secrets_template", "json", true)]
        [InlineData("create-secrets_template", "json", false)]
        [InlineData("Create-Stack", "json", true)]
        [InlineData("Create-Stack", "json", false)]
        [InlineData("dadjokes", "json", true)]
        [InlineData("dadjokes", "json", false)]
        [InlineData("demo-app_template", "json", true)]
        [InlineData("demo-app_template", "json", false)]
        [InlineData("DIRECTORY-AD-CLIENTS", "json", true)]
        [InlineData("DIRECTORY-AD-CLIENTS", "json", false)]
        [InlineData("DIRECTORY_SETTINGS_cfn", "json", true)]
        [InlineData("DIRECTORY_SETTINGS_cfn", "json", false)]
        [InlineData("dotnet-api_template", "json", true)]
        [InlineData("dotnet-api_template", "json", false)]
        [InlineData("DynamoDB_Secondary_Indexes", "json", true)]
        [InlineData("DynamoDB_Secondary_Indexes", "json", false)]
        [InlineData("DynamoDB_Table", "json", true)]
        [InlineData("DynamoDB_Table", "json", false)]
        [InlineData("EC2InstanceWithSecurityGroupSample", "json", true)]
        [InlineData("EC2InstanceWithSecurityGroupSample", "json", false)]
        [InlineData("EC2_Instance_With_Ephemeral_Drives", "json", true)]
        [InlineData("EC2_Instance_With_Ephemeral_Drives", "json", false)]
        [InlineData("EIP_With_Association", "json", true)]
        [InlineData("EIP_With_Association", "json", false)]
        [InlineData("ELBStickinessSample", "json", true)]
        [InlineData("ELBStickinessSample", "json", false)]
        [InlineData("eventbridge-dlq-retry_template", "json", true)]
        [InlineData("eventbridge-dlq-retry_template", "json", false)]
        [InlineData("eventbridge_template", "json", true)]
        [InlineData("eventbridge_template", "json", false)]
        [InlineData("events", "json", true)]
        [InlineData("events", "json", false)]
        [InlineData("example_usage_update_endpoint_policy", "json", true)]
        [InlineData("example_usage_update_endpoint_policy", "json", false)]
        [InlineData("example_usage_update_kms_policy", "json", true)]
        [InlineData("example_usage_update_kms_policy", "json", false)]
        [InlineData("FindInMapAZs", "json", true)]
        [InlineData("FindInMapAZs", "json", false)]
        [InlineData("FindInMap_Inside_Sub", "json", true)]
        [InlineData("FindInMap_Inside_Sub", "json", false)]
        [InlineData("function-template", "json", true)]
        [InlineData("function-template", "json", false)]
        [InlineData("go-al2_template", "json", true)]
        [InlineData("go-al2_template", "json", false)]
        [InlineData("http-api-direct-integration_template", "json", true)]
        [InlineData("http-api-direct-integration_template", "json", false)]
        [InlineData("http-api-integrations-blog-example_template", "json", true)]
        [InlineData("http-api-integrations-blog-example_template", "json", false)]
        [InlineData("http-api-logging_template", "json", true)]
        [InlineData("http-api-logging_template", "json", false)]
        [InlineData("http-api_template", "json", true)]
        [InlineData("http-api_template", "json", false)]
        [InlineData("http_template", "json", true)]
        [InlineData("http_template", "json", false)]
        [InlineData("IAM_Users_Groups_and_Policies", "json", true)]
        [InlineData("IAM_Users_Groups_and_Policies", "json", false)]
        [InlineData("kinesis-firehose_template", "json", true)]
        [InlineData("kinesis-firehose_template", "json", false)]
        [InlineData("lambda-static_cfn", "json", true)]
        [InlineData("lambda-static_cfn", "json", false)]
        [InlineData("layers-repo_template", "json", true)]
        [InlineData("layers-repo_template", "json", false)]
        [InlineData("MANAGEDAD_cfn", "json", true)]
        [InlineData("MANAGEDAD_cfn", "json", false)]
        [InlineData("multi-level-mapping_template", "json", true)]
        [InlineData("multi-level-mapping_template", "json", false)]
        [InlineData("Neptune", "json", true)]
        [InlineData("Neptune", "json", false)]
        [InlineData("node-webpack-custom-build_template", "json", true)]
        [InlineData("node-webpack-custom-build_template", "json", false)]
        [InlineData("Product", "json", true)]
        [InlineData("Product", "json", false)]
        [InlineData("python", "json", true)]
        [InlineData("python", "json", false)]
        [InlineData("RDS_PIOPS", "json", true)]
        [InlineData("RDS_PIOPS", "json", false)]
        [InlineData("RDS_Snapshot_On_Delete", "json", true)]
        [InlineData("RDS_Snapshot_On_Delete", "json", false)]
        [InlineData("RDS_with_DBParameterGroup", "json", true)]
        [InlineData("RDS_with_DBParameterGroup", "json", false)]
        [InlineData("reportingv1", "json", true)]
        [InlineData("reportingv1", "json", false)]
        [InlineData("reportingv2", "json", true)]
        [InlineData("reportingv2", "json", false)]
        [InlineData("rest_template", "json", true)]
        [InlineData("rest_template", "json", false)]
        [InlineData("RHEL7_cfn-hup_cfn", "json", true)]
        [InlineData("RHEL7_cfn-hup_cfn", "json", false)]
        [InlineData("RHEL8_cfn-hup_cfn", "json", true)]
        [InlineData("RHEL8_cfn-hup_cfn", "json", false)]
        [InlineData("s3-bucket-and-policy-for-caa-delete-retention-v1", "json", true)]
        [InlineData("s3-bucket-and-policy-for-caa-delete-retention-v1", "json", false)]
        [InlineData("s3-bucket-and-policy-for-caa-secure-transport-v1", "json", true)]
        [InlineData("s3-bucket-and-policy-for-caa-secure-transport-v1", "json", false)]
        [InlineData("s3-bucket-and-policy-for-caa-sse-v1", "json", true)]
        [InlineData("s3-bucket-and-policy-for-caa-sse-v1", "json", false)]
        [InlineData("s3-bucket-and-policy-for-caa-v1", "json", true)]
        [InlineData("s3-bucket-and-policy-for-caa-v1", "json", false)]
        [InlineData("s3-bucket-and-policy-for-caa-versioning-v1", "json", true)]
        [InlineData("s3-bucket-and-policy-for-caa-versioning-v1", "json", false)]
        [InlineData("s3-bucket-policy-for-caa-secure-transport-v1", "json", true)]
        [InlineData("s3-bucket-policy-for-caa-secure-transport-v1", "json", false)]
        [InlineData("s3-bucket-policy-for-caa-v1", "json", true)]
        [InlineData("s3-bucket-policy-for-caa-v1", "json", false)]
        [InlineData("S3AccessLogs_cfn", "json", true)]
        [InlineData("S3AccessLogs_cfn", "json", false)]
        [InlineData("S3_Website_Bucket_With_Retain_On_Delete", "json", true)]
        [InlineData("S3_Website_Bucket_With_Retain_On_Delete", "json", false)]
        [InlineData("S3_Website_With_CloudFront_Distribution", "json", true)]
        [InlineData("S3_Website_With_CloudFront_Distribution", "json", false)]
        [InlineData("safe-deploy_template", "json", true)]
        [InlineData("safe-deploy_template", "json", false)]
        [InlineData("sam_template", "json", true)]
        [InlineData("sam_template", "json", false)]
        [InlineData("server_template", "json", true)]
        [InlineData("server_template", "json", false)]
        [InlineData("SQS_template", "json", true)]
        [InlineData("SQS_template", "json", false)]
        [InlineData("stack-set-template", "json", true)]
        [InlineData("stack-set-template", "json", false)]
        [InlineData("stackset-function-template", "json", true)]
        [InlineData("stackset-function-template", "json", false)]
        [InlineData("step-functions_template", "json", true)]
        [InlineData("step-functions_template", "json", false)]
        [InlineData("string", "json", true)]
        [InlineData("string", "json", false)]
        [InlineData("string_example", "json", true)]
        [InlineData("string_example", "json", false)]
        [InlineData("swift-custom-runtime_template", "json", true)]
        [InlineData("swift-custom-runtime_template", "json", false)]
        [InlineData("Tagging_Root_volume", "json", true)]
        [InlineData("Tagging_Root_volume", "json", false)]
        [InlineData("ubuntu16_04LTS_cfn-hup_cfn", "json", true)]
        [InlineData("ubuntu16_04LTS_cfn-hup_cfn", "json", false)]
        [InlineData("ubuntu18_04LTS_cfn-hup_cfn", "json", true)]
        [InlineData("ubuntu18_04LTS_cfn-hup_cfn", "json", false)]
        [InlineData("ubuntu20_04LTS_cfn-hup_cfn", "json", true)]
        [InlineData("ubuntu20_04LTS_cfn-hup_cfn", "json", false)]
        [InlineData("VPCFlowLogs-main_cfn", "json", true)]
        [InlineData("VPCFlowLogs-main_cfn", "json", false)]
        [InlineData("VPCFlowLogsCloudWatch_cfn", "json", true)]
        [InlineData("VPCFlowLogsCloudWatch_cfn", "json", false)]
        [InlineData("VPCFlowLogsS3_cfn", "json", true)]
        [InlineData("VPCFlowLogsS3_cfn", "json", false)]
        [InlineData("VPCPeering-Accepter-Role_cfn", "json", true)]
        [InlineData("VPCPeering-Accepter-Role_cfn", "json", false)]
        [InlineData("VPCPeering-Accepter-Tag_cfn", "json", true)]
        [InlineData("VPCPeering-Accepter-Tag_cfn", "json", false)]
        [InlineData("VPCPeering-Accepter_main_cfn", "json", true)]
        [InlineData("VPCPeering-Accepter_main_cfn", "json", false)]
        [InlineData("VPCPeering-Requester-Setup_cfn", "json", true)]
        [InlineData("VPCPeering-Requester-Setup_cfn", "json", false)]
        [InlineData("VPCPeering-Requester_main_cfn", "json", true)]
        [InlineData("VPCPeering-Requester_main_cfn", "json", false)]
        [InlineData("VPCPeering-Updates_cfn", "json", true)]
        [InlineData("VPCPeering-Updates_cfn", "json", false)]
        [InlineData("VPC_EC2_Instance_With_Multiple_Static_IPAddresses", "json", true)]
        [InlineData("VPC_EC2_Instance_With_Multiple_Static_IPAddresses", "json", false)]
        [InlineData("VPC_With_Managed_NAT_And_Private_Subnet", "json", true)]
        [InlineData("VPC_With_Managed_NAT_And_Private_Subnet", "json", false)]
        [InlineData("web-app_template", "json", true)]
        [InlineData("web-app_template", "json", false)]
        [InlineData("WordPress_Single_Instance", "json", true)]
        [InlineData("WordPress_Single_Instance", "json", false)]

        public async void DeserializeThenReserializeShouldProduceSameGraph(
            string templateFile,
            string format,
            bool excludeConditionalResources)
        {
            // If a template is deserialized, re-serialized then deserialized again
            // the dependency graph for each deserialization should match.
            var template = await Template.Deserialize(
                               new DeserializerSettingsBuilder()
                                   .WithTemplateFile(
                                       Path.Combine(this.fixture.TempDirectory, $"{templateFile}.{format}"))
                                   .WithExcludeConditionalResources(excludeConditionalResources)
                                   .Build());

            var initialDotGraph = TestHelpers.GenerateDotGraph(template);
            var yaml = Template.Serialize(template);

            ITemplate finalTemplate;

            try
            {
                finalTemplate = await Template.Deserialize(new DeserializerSettingsBuilder().WithTemplateString(yaml).Build());
            }
            catch (YamlException e)
            {
                Skip.If(e.InnerException is ArgumentNullException { Message: "Value cannot be null. (Parameter 'key')" }, "Bug in YamlDotNet where a key name of 'null' is not quoted on serialization. https://github.com/aaubry/YamlDotNet/issues/591.");

                throw;
            }

            var finalDotGraph = TestHelpers.GenerateDotGraph(finalTemplate);

            initialDotGraph.Should().Be(finalDotGraph);
        }

        [Theory]
        [InlineData("1-initial-setup_template", "yaml")]
        [InlineData("2-managed-rules_template", "yaml")]
        [InlineData("3-custom-rules_template", "yaml")]
        [InlineData("4-reusable-setup_template", "yaml")]
        [InlineData("5-reusable-setup-full_template", "yaml")]
        [InlineData("ADCONNECTOR_cfn", "yaml")]
        [InlineData("admin", "yaml")]
        [InlineData("api-enhanced-observability-variables_template", "yaml")]
        [InlineData("app_template", "yaml")]
        [InlineData("AutoScalingMultiAZWithNotifications", "yaml")]
        [InlineData("both-declared_template", "yaml")]
        [InlineData("both-implied_template", "yaml")]
        [InlineData("C9", "yaml")]
        [InlineData("cfn-endpoint-creationpolicy-no-igw", "yaml")]
        [InlineData("cfn-endpoint-creationpolicy", "yaml")]
        [InlineData("cfn-endpoint-waitcondition-no-igw", "yaml")]
        [InlineData("cfn-endpoint-waitcondition", "yaml")]
        [InlineData("cognito_template", "yaml")]
        [InlineData("Count_template", "yaml")]
        [InlineData("Create-Macro", "yaml")]
        [InlineData("create-secrets_template", "yaml")]
        [InlineData("Create-Stack", "yaml")]
        [InlineData("dadjokes", "yaml")]
        [InlineData("demo-app_template", "yaml")]
        [InlineData("DIRECTORY-AD-CLIENTS", "yaml")]
        [InlineData("DIRECTORY_SETTINGS_cfn", "yaml")]
        [InlineData("dotnet-api_template", "yaml")]
        [InlineData("DynamoDB_Secondary_Indexes", "yaml")]
        [InlineData("DynamoDB_Table", "yaml")]
        [InlineData("EC2InstanceWithSecurityGroupSample", "yaml")]
        [InlineData("EC2_Instance_With_Ephemeral_Drives", "yaml")]
        [InlineData("EIP_With_Association", "yaml")]
        [InlineData("ELBStickinessSample", "yaml")]
        [InlineData("eventbridge-dlq-retry_template", "yaml")]
        [InlineData("eventbridge_template", "yaml")]
        [InlineData("events", "yaml")]
        [InlineData("example_usage_update_endpoint_policy", "yaml")]
        [InlineData("example_usage_update_kms_policy", "yaml")]
        [InlineData("FindInMapAZs", "yaml")]
        [InlineData("FindInMap_Inside_Sub", "yaml")]
        [InlineData("function-template", "yaml")]
        [InlineData("go-al2_template", "yaml")]
        [InlineData("http-api-direct-integration_template", "yaml")]
        [InlineData("http-api-integrations-blog-example_template", "yaml")]
        [InlineData("http-api-logging_template", "yaml")]
        [InlineData("http-api_template", "yaml")]
        [InlineData("http_template", "yaml")]
        [InlineData("IAM_Users_Groups_and_Policies", "yaml")]
        [InlineData("kinesis-firehose_template", "yaml")]
        [InlineData("lambda-static_cfn", "yaml")]
        [InlineData("layers-repo_template", "yaml")]
        [InlineData("MANAGEDAD_cfn", "yaml")]
        [InlineData("multi-level-mapping_template", "yaml")]
        [InlineData("Neptune", "yaml")]
        [InlineData("node-webpack-custom-build_template", "yaml")]
        [InlineData("Product", "yaml")]
        [InlineData("python", "yaml")]
        [InlineData("RDS_PIOPS", "yaml")]
        [InlineData("RDS_Snapshot_On_Delete", "yaml")]
        [InlineData("RDS_with_DBParameterGroup", "yaml")]
        [InlineData("reportingv1", "yaml")]
        [InlineData("reportingv2", "yaml")]
        [InlineData("rest_template", "yaml")]
        [InlineData("RHEL7_cfn-hup_cfn", "yaml")]
        [InlineData("RHEL8_cfn-hup_cfn", "yaml")]
        [InlineData("s3-bucket-and-policy-for-caa-delete-retention-v1", "yaml")]
        [InlineData("s3-bucket-and-policy-for-caa-secure-transport-v1", "yaml")]
        [InlineData("s3-bucket-and-policy-for-caa-sse-v1", "yaml")]
        [InlineData("s3-bucket-and-policy-for-caa-v1", "yaml")]
        [InlineData("s3-bucket-and-policy-for-caa-versioning-v1", "yaml")]
        [InlineData("s3-bucket-policy-for-caa-secure-transport-v1", "yaml")]
        [InlineData("s3-bucket-policy-for-caa-v1", "yaml")]
        [InlineData("S3AccessLogs_cfn", "yaml")]
        [InlineData("S3_Website_Bucket_With_Retain_On_Delete", "yaml")]
        [InlineData("S3_Website_With_CloudFront_Distribution", "yaml")]
        [InlineData("safe-deploy_template", "yaml")]
        [InlineData("sam_template", "yaml")]
        [InlineData("server_template", "yaml")]
        [InlineData("SQS_template", "yaml")]
        [InlineData("stack-set-template", "yaml")]
        [InlineData("stackset-function-template", "yaml")]
        [InlineData("step-functions_template", "yaml")]
        [InlineData("string", "yaml")]
        [InlineData("string_example", "yaml")]
        [InlineData("swift-custom-runtime_template", "yaml")]
        [InlineData("Tagging_Root_volume", "yaml")]
        [InlineData("ubuntu16_04LTS_cfn-hup_cfn", "yaml")]
        [InlineData("ubuntu18_04LTS_cfn-hup_cfn", "yaml")]
        [InlineData("ubuntu20_04LTS_cfn-hup_cfn", "yaml")]
        [InlineData("VPCFlowLogs-main_cfn", "yaml")]
        [InlineData("VPCFlowLogsCloudWatch_cfn", "yaml")]
        [InlineData("VPCFlowLogsS3_cfn", "yaml")]
        [InlineData("VPCPeering-Accepter-Role_cfn", "yaml")]
        [InlineData("VPCPeering-Accepter-Tag_cfn", "yaml")]
        [InlineData("VPCPeering-Accepter_main_cfn", "yaml")]
        [InlineData("VPCPeering-Requester-Setup_cfn", "yaml")]
        [InlineData("VPCPeering-Requester_main_cfn", "yaml")]
        [InlineData("VPCPeering-Updates_cfn", "yaml")]
        [InlineData("VPC_EC2_Instance_With_Multiple_Static_IPAddresses", "yaml")]
        [InlineData("VPC_With_Managed_NAT_And_Private_Subnet", "yaml")]
        [InlineData("web-app_template", "yaml")]
        [InlineData("WordPress_Single_Instance", "yaml")]
        [InlineData("1-initial-setup_template", "json")]
        [InlineData("2-managed-rules_template", "json")]
        [InlineData("3-custom-rules_template", "json")]
        [InlineData("4-reusable-setup_template", "json")]
        [InlineData("5-reusable-setup-full_template", "json")]
        [InlineData("ADCONNECTOR_cfn", "json")]
        [InlineData("admin", "json")]
        [InlineData("api-enhanced-observability-variables_template", "json")]
        [InlineData("app_template", "json")]
        [InlineData("AutoScalingMultiAZWithNotifications", "json")]
        [InlineData("both-declared_template", "json")]
        [InlineData("both-implied_template", "json")]
        [InlineData("C9", "json")]
        [InlineData("cfn-endpoint-creationpolicy-no-igw", "json")]
        [InlineData("cfn-endpoint-creationpolicy", "json")]
        [InlineData("cfn-endpoint-waitcondition-no-igw", "json")]
        [InlineData("cfn-endpoint-waitcondition", "json")]
        [InlineData("cognito_template", "json")]
        [InlineData("Count_template", "json")]
        [InlineData("Create-Macro", "json")]
        [InlineData("create-secrets_template", "json")]
        [InlineData("Create-Stack", "json")]
        [InlineData("dadjokes", "json")]
        [InlineData("demo-app_template", "json")]
        [InlineData("DIRECTORY-AD-CLIENTS", "json")]
        [InlineData("DIRECTORY_SETTINGS_cfn", "json")]
        [InlineData("dotnet-api_template", "json")]
        [InlineData("DynamoDB_Secondary_Indexes", "json")]
        [InlineData("DynamoDB_Table", "json")]
        [InlineData("EC2InstanceWithSecurityGroupSample", "json")]
        [InlineData("EC2_Instance_With_Ephemeral_Drives", "json")]
        [InlineData("EIP_With_Association", "json")]
        [InlineData("ELBStickinessSample", "json")]
        [InlineData("eventbridge-dlq-retry_template", "json")]
        [InlineData("eventbridge_template", "json")]
        [InlineData("events", "json")]
        [InlineData("example_usage_update_endpoint_policy", "json")]
        [InlineData("example_usage_update_kms_policy", "json")]
        [InlineData("FindInMapAZs", "json")]
        [InlineData("FindInMap_Inside_Sub", "json")]
        [InlineData("function-template", "json")]
        [InlineData("go-al2_template", "json")]
        [InlineData("http-api-direct-integration_template", "json")]
        [InlineData("http-api-integrations-blog-example_template", "json")]
        [InlineData("http-api-logging_template", "json")]
        [InlineData("http-api_template", "json")]
        [InlineData("http_template", "json")]
        [InlineData("IAM_Users_Groups_and_Policies", "json")]
        [InlineData("kinesis-firehose_template", "json")]
        [InlineData("lambda-static_cfn", "json")]
        [InlineData("layers-repo_template", "json")]
        [InlineData("MANAGEDAD_cfn", "json")]
        [InlineData("multi-level-mapping_template", "json")]
        [InlineData("Neptune", "json")]
        [InlineData("node-webpack-custom-build_template", "json")]
        [InlineData("Product", "json")]
        [InlineData("python", "json")]
        [InlineData("RDS_PIOPS", "json")]
        [InlineData("RDS_Snapshot_On_Delete", "json")]
        [InlineData("RDS_with_DBParameterGroup", "json")]
        [InlineData("reportingv1", "json")]
        [InlineData("reportingv2", "json")]
        [InlineData("rest_template", "json")]
        [InlineData("RHEL7_cfn-hup_cfn", "json")]
        [InlineData("RHEL8_cfn-hup_cfn", "json")]
        [InlineData("s3-bucket-and-policy-for-caa-delete-retention-v1", "json")]
        [InlineData("s3-bucket-and-policy-for-caa-secure-transport-v1", "json")]
        [InlineData("s3-bucket-and-policy-for-caa-sse-v1", "json")]
        [InlineData("s3-bucket-and-policy-for-caa-v1", "json")]
        [InlineData("s3-bucket-and-policy-for-caa-versioning-v1", "json")]
        [InlineData("s3-bucket-policy-for-caa-secure-transport-v1", "json")]
        [InlineData("s3-bucket-policy-for-caa-v1", "json")]
        [InlineData("S3AccessLogs_cfn", "json")]
        [InlineData("S3_Website_Bucket_With_Retain_On_Delete", "json")]
        [InlineData("S3_Website_With_CloudFront_Distribution", "json")]
        [InlineData("safe-deploy_template", "json")]
        [InlineData("sam_template", "json")]
        [InlineData("server_template", "json")]
        [InlineData("SQS_template", "json")]
        [InlineData("stack-set-template", "json")]
        [InlineData("stackset-function-template", "json")]
        [InlineData("step-functions_template", "json")]
        [InlineData("string", "json")]
        [InlineData("string_example", "json")]
        [InlineData("swift-custom-runtime_template", "json")]
        [InlineData("Tagging_Root_volume", "json")]
        [InlineData("ubuntu16_04LTS_cfn-hup_cfn", "json")]
        [InlineData("ubuntu18_04LTS_cfn-hup_cfn", "json")]
        [InlineData("ubuntu20_04LTS_cfn-hup_cfn", "json")]
        [InlineData("VPCFlowLogs-main_cfn", "json")]
        [InlineData("VPCFlowLogsCloudWatch_cfn", "json")]
        [InlineData("VPCFlowLogsS3_cfn", "json")]
        [InlineData("VPCPeering-Accepter-Role_cfn", "json")]
        [InlineData("VPCPeering-Accepter-Tag_cfn", "json")]
        [InlineData("VPCPeering-Accepter_main_cfn", "json")]
        [InlineData("VPCPeering-Requester-Setup_cfn", "json")]
        [InlineData("VPCPeering-Requester_main_cfn", "json")]
        [InlineData("VPCPeering-Updates_cfn", "json")]
        [InlineData("VPC_EC2_Instance_With_Multiple_Static_IPAddresses", "json")]
        [InlineData("VPC_With_Managed_NAT_And_Private_Subnet", "json")]
        [InlineData("web-app_template", "json")]
        [InlineData("WordPress_Single_Instance", "json")]

        public async void ShouldNotDeserializeConditionWithinResourcePropertiesAsIntrinsic(
            string templateFile,
            string format)
        {
            // Test for an issue when deserializing resources, in that a key of "Condition" within the resource
            // properties is incorrectly converted to a Condition intrinsic
            var template = await Template.Deserialize(new DeserializerSettingsBuilder().WithTemplateFile(
                Path.Combine(this.fixture.TempDirectory, $"{templateFile}.{format}")).Build());

            // Assert that conditions on policy statements were not deserialized as intrinsic
            foreach (var resource in template.Resources)
            {
                TestHelpers.ContainsObjectOfType(resource.Properties, typeof(ConditionIntrinsic)).Should()
                    .BeFalse(
                        "'Condition' within resource properties (e.g. policies) should not be deserialized as intrinsic");
            }
        }

        [Theory]
        [InlineData("1-initial-setup_template", "yaml")]
        [InlineData("2-managed-rules_template", "yaml")]
        [InlineData("3-custom-rules_template", "yaml")]
        [InlineData("4-reusable-setup_template", "yaml")]
        [InlineData("5-reusable-setup-full_template", "yaml")]
        [InlineData("ADCONNECTOR_cfn", "yaml")]
        [InlineData("admin", "yaml")]
        [InlineData("api-enhanced-observability-variables_template", "yaml")]
        [InlineData("app_template", "yaml")]
        [InlineData("AutoScalingMultiAZWithNotifications", "yaml")]
        [InlineData("both-declared_template", "yaml")]
        [InlineData("both-implied_template", "yaml")]
        [InlineData("C9", "yaml")]
        [InlineData("cfn-endpoint-creationpolicy-no-igw", "yaml")]
        [InlineData("cfn-endpoint-creationpolicy", "yaml")]
        [InlineData("cfn-endpoint-waitcondition-no-igw", "yaml")]
        [InlineData("cfn-endpoint-waitcondition", "yaml")]
        [InlineData("cognito_template", "yaml")]
        [InlineData("Count_template", "yaml")]
        [InlineData("Create-Macro", "yaml")]
        [InlineData("create-secrets_template", "yaml")]
        [InlineData("Create-Stack", "yaml")]
        [InlineData("dadjokes", "yaml")]
        [InlineData("demo-app_template", "yaml")]
        [InlineData("DIRECTORY-AD-CLIENTS", "yaml")]
        [InlineData("DIRECTORY_SETTINGS_cfn", "yaml")]
        [InlineData("dotnet-api_template", "yaml")]
        [InlineData("DynamoDB_Secondary_Indexes", "yaml")]
        [InlineData("DynamoDB_Table", "yaml")]
        [InlineData("EC2InstanceWithSecurityGroupSample", "yaml")]
        [InlineData("EC2_Instance_With_Ephemeral_Drives", "yaml")]
        [InlineData("EIP_With_Association", "yaml")]
        [InlineData("ELBStickinessSample", "yaml")]
        [InlineData("eventbridge-dlq-retry_template", "yaml")]
        [InlineData("eventbridge_template", "yaml")]
        [InlineData("events", "yaml")]
        [InlineData("example_usage_update_endpoint_policy", "yaml")]
        [InlineData("example_usage_update_kms_policy", "yaml")]
        [InlineData("FindInMapAZs", "yaml")]
        [InlineData("FindInMap_Inside_Sub", "yaml")]
        [InlineData("function-template", "yaml")]
        [InlineData("go-al2_template", "yaml")]
        [InlineData("http-api-direct-integration_template", "yaml")]
        [InlineData("http-api-integrations-blog-example_template", "yaml")]
        [InlineData("http-api-logging_template", "yaml")]
        [InlineData("http-api_template", "yaml")]
        [InlineData("http_template", "yaml")]
        [InlineData("IAM_Users_Groups_and_Policies", "yaml")]
        [InlineData("kinesis-firehose_template", "yaml")]
        [InlineData("lambda-static_cfn", "yaml")]
        [InlineData("layers-repo_template", "yaml")]
        [InlineData("MANAGEDAD_cfn", "yaml")]
        [InlineData("multi-level-mapping_template", "yaml")]
        [InlineData("Neptune", "yaml")]
        [InlineData("node-webpack-custom-build_template", "yaml")]
        [InlineData("Product", "yaml")]
        [InlineData("python", "yaml")]
        [InlineData("RDS_PIOPS", "yaml")]
        [InlineData("RDS_Snapshot_On_Delete", "yaml")]
        [InlineData("RDS_with_DBParameterGroup", "yaml")]
        [InlineData("reportingv1", "yaml")]
        [InlineData("reportingv2", "yaml")]
        [InlineData("rest_template", "yaml")]
        [InlineData("RHEL7_cfn-hup_cfn", "yaml")]
        [InlineData("RHEL8_cfn-hup_cfn", "yaml")]
        [InlineData("s3-bucket-and-policy-for-caa-delete-retention-v1", "yaml")]
        [InlineData("s3-bucket-and-policy-for-caa-secure-transport-v1", "yaml")]
        [InlineData("s3-bucket-and-policy-for-caa-sse-v1", "yaml")]
        [InlineData("s3-bucket-and-policy-for-caa-v1", "yaml")]
        [InlineData("s3-bucket-and-policy-for-caa-versioning-v1", "yaml")]
        [InlineData("s3-bucket-policy-for-caa-secure-transport-v1", "yaml")]
        [InlineData("s3-bucket-policy-for-caa-v1", "yaml")]
        [InlineData("S3AccessLogs_cfn", "yaml")]
        [InlineData("S3_Website_Bucket_With_Retain_On_Delete", "yaml")]
        [InlineData("S3_Website_With_CloudFront_Distribution", "yaml")]
        [InlineData("safe-deploy_template", "yaml")]
        [InlineData("sam_template", "yaml")]
        [InlineData("server_template", "yaml")]
        [InlineData("SQS_template", "yaml")]
        [InlineData("stack-set-template", "yaml")]
        [InlineData("stackset-function-template", "yaml")]
        [InlineData("step-functions_template", "yaml")]
        [InlineData("string", "yaml")]
        [InlineData("string_example", "yaml")]
        [InlineData("swift-custom-runtime_template", "yaml")]
        [InlineData("Tagging_Root_volume", "yaml")]
        [InlineData("ubuntu16_04LTS_cfn-hup_cfn", "yaml")]
        [InlineData("ubuntu18_04LTS_cfn-hup_cfn", "yaml")]
        [InlineData("ubuntu20_04LTS_cfn-hup_cfn", "yaml")]
        [InlineData("VPCFlowLogs-main_cfn", "yaml")]
        [InlineData("VPCFlowLogsCloudWatch_cfn", "yaml")]
        [InlineData("VPCFlowLogsS3_cfn", "yaml")]
        [InlineData("VPCPeering-Accepter-Role_cfn", "yaml")]
        [InlineData("VPCPeering-Accepter-Tag_cfn", "yaml")]
        [InlineData("VPCPeering-Accepter_main_cfn", "yaml")]
        [InlineData("VPCPeering-Requester-Setup_cfn", "yaml")]
        [InlineData("VPCPeering-Requester_main_cfn", "yaml")]
        [InlineData("VPCPeering-Updates_cfn", "yaml")]
        [InlineData("VPC_EC2_Instance_With_Multiple_Static_IPAddresses", "yaml")]
        [InlineData("VPC_With_Managed_NAT_And_Private_Subnet", "yaml")]
        [InlineData("web-app_template", "yaml")]
        [InlineData("WordPress_Single_Instance", "yaml")]
        [InlineData("1-initial-setup_template", "json")]
        [InlineData("2-managed-rules_template", "json")]
        [InlineData("3-custom-rules_template", "json")]
        [InlineData("4-reusable-setup_template", "json")]
        [InlineData("5-reusable-setup-full_template", "json")]
        [InlineData("ADCONNECTOR_cfn", "json")]
        [InlineData("admin", "json")]
        [InlineData("api-enhanced-observability-variables_template", "json")]
        [InlineData("app_template", "json")]
        [InlineData("AutoScalingMultiAZWithNotifications", "json")]
        [InlineData("both-declared_template", "json")]
        [InlineData("both-implied_template", "json")]
        [InlineData("C9", "json")]
        [InlineData("cfn-endpoint-creationpolicy-no-igw", "json")]
        [InlineData("cfn-endpoint-creationpolicy", "json")]
        [InlineData("cfn-endpoint-waitcondition-no-igw", "json")]
        [InlineData("cfn-endpoint-waitcondition", "json")]
        [InlineData("cognito_template", "json")]
        [InlineData("Count_template", "json")]
        [InlineData("Create-Macro", "json")]
        [InlineData("create-secrets_template", "json")]
        [InlineData("Create-Stack", "json")]
        [InlineData("dadjokes", "json")]
        [InlineData("demo-app_template", "json")]
        [InlineData("DIRECTORY-AD-CLIENTS", "json")]
        [InlineData("DIRECTORY_SETTINGS_cfn", "json")]
        [InlineData("dotnet-api_template", "json")]
        [InlineData("DynamoDB_Secondary_Indexes", "json")]
        [InlineData("DynamoDB_Table", "json")]
        [InlineData("EC2InstanceWithSecurityGroupSample", "json")]
        [InlineData("EC2_Instance_With_Ephemeral_Drives", "json")]
        [InlineData("EIP_With_Association", "json")]
        [InlineData("ELBStickinessSample", "json")]
        [InlineData("eventbridge-dlq-retry_template", "json")]
        [InlineData("eventbridge_template", "json")]
        [InlineData("events", "json")]
        [InlineData("example_usage_update_endpoint_policy", "json")]
        [InlineData("example_usage_update_kms_policy", "json")]
        [InlineData("FindInMapAZs", "json")]
        [InlineData("FindInMap_Inside_Sub", "json")]
        [InlineData("function-template", "json")]
        [InlineData("go-al2_template", "json")]
        [InlineData("http-api-direct-integration_template", "json")]
        [InlineData("http-api-integrations-blog-example_template", "json")]
        [InlineData("http-api-logging_template", "json")]
        [InlineData("http-api_template", "json")]
        [InlineData("http_template", "json")]
        [InlineData("IAM_Users_Groups_and_Policies", "json")]
        [InlineData("kinesis-firehose_template", "json")]
        [InlineData("lambda-static_cfn", "json")]
        [InlineData("layers-repo_template", "json")]
        [InlineData("MANAGEDAD_cfn", "json")]
        [InlineData("multi-level-mapping_template", "json")]
        [InlineData("Neptune", "json")]
        [InlineData("node-webpack-custom-build_template", "json")]
        [InlineData("Product", "json")]
        [InlineData("python", "json")]
        [InlineData("RDS_PIOPS", "json")]
        [InlineData("RDS_Snapshot_On_Delete", "json")]
        [InlineData("RDS_with_DBParameterGroup", "json")]
        [InlineData("reportingv1", "json")]
        [InlineData("reportingv2", "json")]
        [InlineData("rest_template", "json")]
        [InlineData("RHEL7_cfn-hup_cfn", "json")]
        [InlineData("RHEL8_cfn-hup_cfn", "json")]
        [InlineData("s3-bucket-and-policy-for-caa-delete-retention-v1", "json")]
        [InlineData("s3-bucket-and-policy-for-caa-secure-transport-v1", "json")]
        [InlineData("s3-bucket-and-policy-for-caa-sse-v1", "json")]
        [InlineData("s3-bucket-and-policy-for-caa-v1", "json")]
        [InlineData("s3-bucket-and-policy-for-caa-versioning-v1", "json")]
        [InlineData("s3-bucket-policy-for-caa-secure-transport-v1", "json")]
        [InlineData("s3-bucket-policy-for-caa-v1", "json")]
        [InlineData("S3AccessLogs_cfn", "json")]
        [InlineData("S3_Website_Bucket_With_Retain_On_Delete", "json")]
        [InlineData("S3_Website_With_CloudFront_Distribution", "json")]
        [InlineData("safe-deploy_template", "json")]
        [InlineData("sam_template", "json")]
        [InlineData("server_template", "json")]
        [InlineData("SQS_template", "json")]
        [InlineData("stack-set-template", "json")]
        [InlineData("stackset-function-template", "json")]
        [InlineData("step-functions_template", "json")]
        [InlineData("string", "json")]
        [InlineData("string_example", "json")]
        [InlineData("swift-custom-runtime_template", "json")]
        [InlineData("Tagging_Root_volume", "json")]
        [InlineData("ubuntu16_04LTS_cfn-hup_cfn", "json")]
        [InlineData("ubuntu18_04LTS_cfn-hup_cfn", "json")]
        [InlineData("ubuntu20_04LTS_cfn-hup_cfn", "json")]
        [InlineData("VPCFlowLogs-main_cfn", "json")]
        [InlineData("VPCFlowLogsCloudWatch_cfn", "json")]
        [InlineData("VPCFlowLogsS3_cfn", "json")]
        [InlineData("VPCPeering-Accepter-Role_cfn", "json")]
        [InlineData("VPCPeering-Accepter-Tag_cfn", "json")]
        [InlineData("VPCPeering-Accepter_main_cfn", "json")]
        [InlineData("VPCPeering-Requester-Setup_cfn", "json")]
        [InlineData("VPCPeering-Requester_main_cfn", "json")]
        [InlineData("VPCPeering-Updates_cfn", "json")]
        [InlineData("VPC_EC2_Instance_With_Multiple_Static_IPAddresses", "json")]
        [InlineData("VPC_With_Managed_NAT_And_Private_Subnet", "json")]
        [InlineData("web-app_template", "json")]
        [InlineData("WordPress_Single_Instance", "json")]

        public async void ShouldSerializeComplexObjectsWhichAreArgumentsOfInstrinsics(
            string templateFile,
            string format)
        {
            // Test that complex structures that are arguments of an intrinsic, e.g. an entire policy document
            // as one of the branches of !If are correctly serialized.
            // When they aren't, then we see type names like System.Collections.Generic.Dictionary since the dict
            // was serialized as a scalar and ToString was implicitly called.
            var template = await Template.Deserialize(new DeserializerSettingsBuilder().WithTemplateFile(
                               Path.Combine(this.fixture.TempDirectory, $"{templateFile}.{format}")).Build());

            var yaml = Template.Serialize(template);

            // Assert compound structures within intrinsics were correctly serialized.
            yaml.Should().NotContain("System.Collections.", "type should have been serialized");
        }
    }
}